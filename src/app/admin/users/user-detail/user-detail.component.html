<div class="page-container">
    <div class="page-content flex-col gap-2xl">
        <!-- Back Button -->
        <button (click)="navigateBack()" class="back-button">
            <span class="material-symbols-outlined">arrow_forward</span>
            العودة للمستخدمين
        </button>

        <!-- Loading State -->
        <div *ngIf="isLoading" class="flex-col items-center justify-center p-4xl">
            <div class="loading-spinner"></div>
            <p class="text-muted mt-lg">جاري تحميل بيانات المستخدم...</p>
        </div>

        <!-- Error/Not Found State -->
        <div *ngIf="!isLoading && !user" class="flex-col items-center justify-center p-4xl text-center">
            <span class="material-symbols-outlined text-4xl text-muted mb-md">person_off</span>
            <h2 class="text-xl font-bold mb-md">لم يتم العثور على المستخدم</h2>
            <p class="text-muted mb-xl">قد يكون المستخدم غير موجود أو تم حذفه</p>
            <app-button (click)="navigateBack()">العودة لقائمة المستخدمين</app-button>
        </div>

        <!-- User Data Content -->
        <ng-container *ngIf="!isLoading && user">
            <!-- Standard Page Header -->
            <app-page-header [title]="user.name" [subtitle]="'@' + (user.username || user.email) + ' • ' + user.email">
                <app-button (click)="toggleUserStatus()" [variant]="user.status === 'Active' ? 'danger' : 'primary'"
                    [icon]="user.status === 'Active' ? 'block' : 'check_circle'">
                    {{ user.status === 'Active' ? 'تعطيل الحساب' : 'تفعيل الحساب' }}
                </app-button>
            </app-page-header>

            <!-- User Details & Activity -->
            <div class="grid-3-cols gap-2xl">
                <div class="flex-col gap-xl">
                    <!-- Identity Card -->
                    <div class="card p-xl flex-col items-center text-center animate-fade-in-up">
                        <div class="mb-lg relative" style="width: 120px; height: 120px;">
                            <app-smart-image [src]="user.avatar" [type]="user.role === 'Referee' ? 'referee' : 'avatar'"
                                size="lg" [initials]="user.name.charAt(0)">
                            </app-smart-image>
                            <div class="absolute bottom-1 right-1 p-1 bg-surface rounded-full shadow-sm">
                                <app-badge [type]="getBadgeType(user.status)">
                                    {{ getStatusLabel(user.status) }}
                                </app-badge>
                            </div>
                        </div>

                        <h2 class="text-xl font-bold text-primary mb-1">{{ user.name }}</h2>
                        <div class="flex items-center gap-2 text-secondary mb-xl">
                            <span class="material-symbols-outlined text-gold">military_tech</span>
                            <span class="font-semibold">{{ getRoleLabel(user.role) }}</span>
                        </div>

                        <div class="w-full border-t pt-md flex justify-between text-sm">
                            <span class="text-muted">المعرف</span>
                            <span class="font-mono text-primary font-bold">#{{ user.id }}</span>
                        </div>
                    </div>

                    <!-- Personal Info Card -->
                    <div class="card animate-fade-in-up" style="animation-delay: 0.1s">
                        <h3 class="card-title flex items-center gap-2 mb-xl">
                            <span class="material-symbols-outlined text-primary">info</span>
                            المعلومات الشخصية
                        </h3>
                        <div class="flex-col gap-lg">
                            <div class="grid-2-cols gap-md">
                                <div class="flex-col gap-1">
                                    <span class="text-xs text-muted">رقم الهوية</span>
                                    <span class="text-sm font-bold text-secondary">{{ user.nationalId || '—' }}</span>
                                </div>
                                <div class="flex-col gap-1">
                                    <span class="text-xs text-muted">العمر</span>
                                    <span class="text-sm font-bold text-secondary">{{ user.age || '—' }} سنة</span>
                                </div>
                            </div>
                            <div class="flex-col gap-1">
                                <span class="text-xs text-muted">العنوان</span>
                                <span class="text-sm text-secondary">
                                    {{ user.governorate || '—' }} - {{ user.city || '—' }} - {{ user.neighborhood || '—'
                                    }}
                                </span>
                            </div>
                            <div class="flex-col gap-1">
                                <span class="text-xs text-muted">رقم الهاتف</span>
                                <span class="text-sm text-secondary font-mono">{{ user.phone || 'غير مسجل' }}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Identity Documents Card -->
                    <div class="card animate-fade-in-up" style="animation-delay: 0.2s">
                        <h3 class="card-title flex items-center gap-2 mb-xl">
                            <span class="material-symbols-outlined text-primary">domain_verification</span>
                            وثائق الهوية
                        </h3>
                        <div class="flex-col gap-lg">
                            <div class="id-card-view">
                                <span class="text-xs text-muted mb-xs block">وجه البطاقة</span>
                                <div class="id-card-img-wrapper" style="height: 160px;">
                                    <app-smart-image [src]="user.idFrontUrl" type="id" size="custom"></app-smart-image>
                                </div>
                            </div>
                            <div class="id-card-view">
                                <span class="text-xs text-muted mb-xs block">ظهر البطاقة</span>
                                <div class="id-card-img-wrapper" style="height: 160px;">
                                    <app-smart-image [src]="user.idBackUrl" type="id" size="custom"></app-smart-image>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-span-2">
                    <div class="card h-full animate-fade-in-up" style="animation-delay: 0.2s">
                        <h3 class="card-title flex items-center gap-2 mb-xl">
                            <span class="material-symbols-outlined text-primary">history</span>
                            النشاط الأخير
                        </h3>
                        <div class="flex-col gap-lg">
                            <div *ngFor="let activity of user.activities" class="card card-hover flex gap-lg p-md">
                                <div class="avatar avatar-md flex-shrink-0"
                                    [ngClass]="getActivityBadgeClass(activity.type)">
                                    <span class="material-symbols-outlined">{{ getActivityIcon(activity.type) }}</span>
                                </div>
                                <div class="flex-col gap-1">
                                    <p class="text-sm text-secondary mb-0">{{ activity.message }}</p>
                                    <span class="text-xs text-muted">{{ activity.createdAt | date:'yyyy/MM/dd HH:mm'
                                        }}</span>
                                </div>
                            </div>
                            <div *ngIf="!user.activities || user.activities.length === 0" class="empty-state">
                                لا يوجد نشاط مسجل حالياً
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </ng-container>
    </div>
</div>