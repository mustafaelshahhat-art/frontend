<div class="auth-container bg-gradient-login">
    <!-- Background Pattern -->
    <div class="ramadan-pattern"></div>

    <!-- Register Card -->
    <div class="auth-card" [class.animate-fade-in-up]="isPageReady()">
        <!-- Header Section -->
        <header class="text-center mb-xl flex flex-col items-center">
            <div class="auth-logo gradient-primary shadow-glow mx-auto">
                <span class="material-symbols-outlined text-4xl text-primary" aria-hidden="true">sports_soccer</span>
            </div>
            <h1 class="auth-title">بطولة رمضان</h1>
            <p class="text-secondary text-base">إنشاء حساب جديد للمشاركة في البطولة</p>
        </header>

        <!-- Step 1: Account Type Selection -->
        @if (currentStep() === 1) {
        <div class="selection-container">
            <h2 class="text-xl font-bold mb-6 text-center">اختر نوع الحساب</h2>
            <p class="selection-subtitle text-center">يرجى تحديد الدور الذي ستقوم به في بطولة رمضان. سيساعدنا هذا في
                تخصيص تجربتك بشكل أفضل.</p>

            <div class="cards-grid-selection">
                <!-- Referee Card -->
                <div class="role-card" [class.selected]="form.role() === UserRole.REFEREE"
                    (click)="form.role.set(UserRole.REFEREE)" (keyup.enter)="form.role.set(UserRole.REFEREE)"
                    role="button" tabindex="0" aria-label="تسجيل كحكم">
                    <div class="role-card-icon">
                        <span class="material-symbols-outlined" aria-hidden="true">sports_whistle</span>
                    </div>
                    <div class="role-card-content">
                        <h3 class="role-card-title">حكم</h3>
                        <p class="role-card-desc">إدارة المباريات، تسجيل النتائج، وضمان اللعب النظيف وتطبيق قوانين
                            البطولة بدقة واحترافية.</p>
                    </div>
                </div>

                <!-- Player Card -->
                <div class="role-card" [class.selected]="form.role() === UserRole.PLAYER"
                    (click)="form.role.set(UserRole.PLAYER)" (keyup.enter)="form.role.set(UserRole.PLAYER)"
                    role="button" tabindex="0" aria-label="تسجيل كلاعب">
                    <div class="role-card-icon">
                        <span class="material-symbols-outlined">groups</span>
                    </div>
                    <div class="role-card-content">
                        <h3 class="role-card-title">لاعب</h3>
                        <p class="role-card-desc">انضم للبطولة كلاعب، شارك في فريق أو قم بإنشاء فريقك الخاص لتصبح قائداً
                            وأدر تشكيلتك بكل سهولة.</p>
                    </div>
                </div>
            </div>

            <div class="flex justify-center mt-xl">
                <app-button variant="primary" size="xl" (trigger)="nextStep(form.role())" icon="arrow_back"
                    iconPos="right">
                    متابعة
                </app-button>
            </div>

            <div class="text-center mt-6">
                <p class="text-secondary text-sm">
                    لديك حساب بالفعل؟
                    <a routerLink="/auth/login" class="text-gold font-bold hover:underline ml-1">تسجيل الدخول</a>
                </p>
            </div>
        </div>
        }

        <!-- Step 2: Detailed Registration Form -->
        @if (currentStep() === 2) {
        <div class="form-container-inner" [class.animate-slide-in-left]="isPageReady()">
            <div class="form-header-inner text-center">
                <div class="avatar avatar-lg gradient-primary mx-auto mb-4 rounded-2xl flex-center step-avatar">
                    <span class="material-symbols-outlined text-xl text-primary">person_add</span>
                </div>
                <h2 class="form-step-title">بيانات ال{{ form.role() === UserRole.REFEREE ? 'حكم' : 'لاعب' }}</h2>
                <p class="form-step-subtitle">أدخل بياناتك الشخصية لإتمام التسجيل في البطولة</p>
            </div>

            <form (ngSubmit)="onSubmit()" #registerForm="ngForm">
                <div class="form-grid">
                    <!-- Full Name -->
                    <div class="form-group grid-col-span-2">
                        <app-form-control label="الاسم رباعي" name="name" [ngModel]="form.name()"
                            (ngModelChange)="form.name.set($event)" required
                            placeholder="أدخل اسمك بالكامل كما في البطاقة" />
                    </div>

                    <!-- Email -->
                    <div class="form-group">
                        <app-form-control label="البريد الإلكتروني" type="email" name="email" [ngModel]="form.email()"
                            (ngModelChange)="form.email.set($event)" required placeholder="example@mail.com"
                            iconLeft="mail" />
                    </div>

                    <!-- Phone -->
                    <div class="form-group">
                        <app-form-control label="رقم الهاتف" type="tel" name="phone" [ngModel]="form.phone()"
                            (ngModelChange)="form.phone.set($event)" required placeholder="05xxxxxxxx" iconLeft="phone" />
                    </div>

                    <!-- Age -->
                    <div class="form-group">
                        <app-form-control label="العمر" type="number" name="age" [ngModel]="form.age()"
                            (ngModelChange)="form.age.set($event)" required placeholder="سنوات" />
                    </div>

                    <!-- National ID -->
                    <div class="form-group">
                        <app-form-control label="الرقم القومي" type="text" name="nationalId"
                            [ngModel]="form.nationalId()" (ngModelChange)="form.nationalId.set($event)" required
                            placeholder="14 رقم" iconLeft="badge" />
                    </div>

                    <!-- Governorate -->
                    <div class="form-group">
                        <label class="form-label" for="governorate">المحافظة</label>
                        <app-select id="governorate" name="governorate" [options]="governorateOptions()"
                            [ngModel]="form.governorate()" (ngModelChange)="onGovChange($event)"
                            placeholder="اختر المحافظة" />
                    </div>

                    <!-- City -->
                    <div class="form-group">
                        <label class="form-label" for="city">المدينة</label>
                        <app-select id="city" name="city" [options]="cityOptions()" [ngModel]="form.city()"
                            (ngModelChange)="onCityChange($event)" [disabled]="!form.governorate()"
                            placeholder="اختر المدينة" />
                    </div>

                    <!-- Neighborhood -->
                    <div class="form-group">
                        <label class="form-label" for="neighborhood">الحي / المنطقة</label>
                        <app-select id="neighborhood" name="neighborhood" [options]="neighborhoodOptions()"
                            [ngModel]="form.neighborhood()" (ngModelChange)="form.neighborhood.set($event)"
                            [disabled]="!form.city()" placeholder="اختر الحي" />
                    </div>

                    <!-- Password -->
                    <div class="form-group">
                        <app-form-control label="كلمة المرور" type="password" name="password"
                            [ngModel]="form.password()" (ngModelChange)="form.password.set($event)"
                            placeholder="••••••••" iconLeft="lock" required />
                    </div>

                    <!-- Confirm Password -->
                    <div class="form-group">
                        <app-form-control label="تأكيد كلمة المرور" type="password" name="confirmPassword"
                            [ngModel]="form.confirmPassword()" (ngModelChange)="form.confirmPassword.set($event)"
                            placeholder="••••••••" iconLeft="lock" required />
                    </div>
                </div>

                <!-- ID Photos -->
                <div class="file-upload-grid mb-6">
                    <div class="file-upload-box" [class.has-file]="form.idFront()" (click)="frontInput.click()"
                        (keyup.enter)="frontInput.click()" tabindex="0">
                        <input type="file" #frontInput hidden (change)="onFileChange($event, 'idFront')"
                            accept="image/*">
                        <span class="material-symbols-outlined file-upload-icon">{{ form.idFront() ? 'check_circle' :
                            'badge' }}</span>
                        <p class="file-upload-text">{{ form.idFront() ? 'تم رفع الوجه الأمامي' : 'صورة الوجه الأمامي' }}
                        </p>
                    </div>

                    <div class="file-upload-box" [class.has-file]="form.idBack()" (click)="backInput.click()"
                        (keyup.enter)="backInput.click()" tabindex="0">
                        <input type="file" #backInput hidden (change)="onFileChange($event, 'idBack')" accept="image/*">
                        <span class="material-symbols-outlined file-upload-icon">{{ form.idBack() ? 'check_circle' :
                            'contact_page' }}</span>
                        <p class="file-upload-text">{{ form.idBack() ? 'تم رفع الوجه الخلفي' : 'صورة الوجه الخلفي' }}
                        </p>
                    </div>
                </div>


                <div class="flex justify-center">
                    <app-button type="submit" variant="primary" size="xl" [isLoading]="isLoading()"
                        [disabled]="isLoading() || !registerForm.valid">
                        إرسال طلب التسجيل
                    </app-button>
                </div>

                <div class="text-center mt-4">
                    <app-button variant="ghost" (trigger)="currentStep.set(1)">
                        العودة لاختيار الدور
                    </app-button>
                </div>
            </form>
        </div>
        }
    </div>

    <!-- Footer -->
    <footer class="auth-footer">
        <p class="text-muted text-xs m-0">© 2024 دوري رمضان لكرة القدم. جميع الحقوق محفوظة.</p>
    </footer>
</div>