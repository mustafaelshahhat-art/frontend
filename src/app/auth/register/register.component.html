<div class="auth-container">
    <!-- Header -->
    <header class="auth-header">
        <div class="auth-brand">
            <div class="auth-brand-icon">
                <span class="material-symbols-outlined text-lg text-primary">sports_soccer</span>
            </div>
            <span>بطولة رمضان</span>
        </div>
        <div class="text-secondary text-sm">
            مرحباً، المستخدم
        </div>
    </header>

    <!-- Step 1: Account Type Selection -->
    <div *ngIf="currentStep === 1" class="selection-container animate-fade-in-up">
        <h1 class="selection-title">اختر نوع الحساب</h1>
        <p class="selection-subtitle">يرجى تحديد الدور الذي ستقوم به في بطولة رمضان. سيساعدنا هذا في تخصيص تجربتك بشكل
            أفضل.</p>

        <div class="cards-grid-selection">
            <!-- Referee Card -->
            <div class="role-card" [class.selected]="form.role === UserRole.REFEREE"
                (click)="form.role = UserRole.REFEREE">
                <div class="role-card-bg role-card-bg-referee">
                </div>
                <div class="role-card-icon">
                    <span class="material-symbols-outlined">sports_whistle</span>
                </div>
                <div class="role-card-content">
                    <h3 class="role-card-title">حكم</h3>
                    <p class="role-card-desc">إدارة المباريات، تسجيل النتائج، وضمان اللعب النظيف وتطبيق قوانين البطولة
                        بدقة
                        واحترافية.</p>
                </div>
            </div>

            <!-- Player Card -->
            <div class="role-card" [class.selected]="form.role === UserRole.CAPTAIN"
                (click)="form.role = UserRole.CAPTAIN">
                <div class="role-card-bg role-card-bg-captain">
                </div>
                <div class="role-card-icon">
                    <span class="material-symbols-outlined">groups</span>
                </div>
                <div class="role-card-content">
                    <h3 class="role-card-title">لاعب</h3>
                    <p class="role-card-desc">انضم للبطولة كلاعب، شارك في فريق أو قم بإنشاء فريقك الخاص لتصبح قائداً
                        وأدر تشكيلتك بكل سهولة.</p>
                </div>
            </div>

        </div>

        <app-button variant="primary" size="xl" (onClick)="currentStep = 2" icon="arrow_back" iconPos="right">
            متابعة
        </app-button>
    </div>

    <!-- Step 2: Detailed Registration Form -->
    <div *ngIf="currentStep === 2" class="form-container animate-slide-in-left">
        <div class="text-center mb-3xl">
            <div class="avatar avatar-lg gradient-primary mx-auto mb-6 rounded-2xl flex-center">
                <span class="material-symbols-outlined text-2xl text-primary">person_add</span>
            </div>
            <h2 class="text-primary text-2xl font-extrabold mb-2">إنشاء حساب {{ form.role
                === UserRole.REFEREE ? 'حكم' : 'لاعب' }}</h2>

            <p class="text-secondary">أدخل بياناتك الشخصية لإتمام التسجيل</p>
        </div>

        <form (ngSubmit)="onSubmit()" #registerForm="ngForm">
            <div class="form-grid">
                <!-- Full Name -->
                <div class="form-group" [class.grid-col-span-2]="true">
                    <label class="form-label">الاسم رباعي</label>
                    <input type="text" name="fullName" [(ngModel)]="form.fullName" required class="form-input"
                        placeholder="أدخل اسمك الكامل كما في البطاقة الشخصية">
                </div>

                <!-- Email -->
                <div class="form-group">
                    <label class="form-label">البريد الإلكتروني</label>
                    <input type="email" name="email" [(ngModel)]="form.email" required class="form-input"
                        placeholder="example@mail.com">
                </div>

                <!-- Phone -->
                <div class="form-group">
                    <label class="form-label">رقم الهاتف</label>
                    <input type="tel" name="phone" [(ngModel)]="form.phone" required class="form-input"
                        placeholder="05xxxxxxxx">
                </div>

                <!-- Age -->
                <div class="form-group">
                    <label class="form-label">العمر</label>
                    <input type="number" name="age" [(ngModel)]="form.age" required class="form-input"
                        placeholder="سنوات">
                </div>

                <!-- National ID -->
                <div class="form-group">
                    <label class="form-label">الرقم القومي</label>
                    <input type="text" name="nationalId" [(ngModel)]="form.nationalId" required class="form-input"
                        placeholder="14 رقم">
                </div>

                <!-- Governorate -->
                <div class="form-group">
                    <label class="form-label">المحافظة</label>
                    <select name="governorate" [(ngModel)]="form.governorate" (change)="onGovChange()" required
                        class="form-input">
                        <option value="" disabled>اختر المحافظة</option>
                        <option *ngFor="let gov of locations" [value]="gov.name">{{gov.name}}</option>
                    </select>
                </div>

                <!-- City -->
                <div class="form-group">
                    <label class="form-label">المدينة</label>
                    <select name="city" [(ngModel)]="form.city" [disabled]="!form.governorate" (change)="onCityChange()"
                        required class="form-input">
                        <option value="" disabled>اختر المدينة</option>
                        <option *ngFor="let city of selectedGovernorate?.cities" [value]="city.name">{{city.name}}
                        </option>
                    </select>
                </div>

                <!-- Neighborhood -->
                <div class="form-group" [class.grid-col-span-2]="true">
                    <label class="form-label">الحي</label>
                    <select name="neighborhood" [(ngModel)]="form.neighborhood" [disabled]="!form.city" required
                        class="form-input">
                        <option value="" disabled>اختر الحي</option>
                        <option *ngFor="let district of selectedCity?.neighborhoods" [value]="district">{{district}}
                        </option>
                    </select>
                </div>

                <!-- Password -->
                <div class="form-group">
                    <label class="form-label">كلمة المرور</label>
                    <input type="password" name="password" [(ngModel)]="form.password" required class="form-input"
                        placeholder="••••••••">
                </div>

                <!-- Confirm Password -->
                <div class="form-group">
                    <label class="form-label">تأكيد كلمة المرور</label>
                    <input type="password" name="confirmPassword" [(ngModel)]="form.confirmPassword" required
                        class="form-input" placeholder="••••••••">
                </div>
            </div>

            <!-- ID Photos -->
            <div class="file-upload-grid">
                <div class="file-upload-box" [class.has-file]="form.idFront" (click)="frontInput.click()">
                    <input type="file" #frontInput hidden (change)="onFileChange($event, 'idFront')" accept="image/*">
                    <span class="material-symbols-outlined file-upload-icon">{{ form.idFront ? 'check_circle' : 'badge'
                        }}</span>
                    <p class="file-upload-text text-primary font-semibold">{{ form.idFront ? 'تم رفع الوجه الأمامي' :
                        'صورة الوجه
                        الأمامي' }}</p>
                    <p class="file-upload-hint">PNG, JPG حتى 5MB</p>
                </div>

                <div class="file-upload-box" [class.has-file]="form.idBack" (click)="backInput.click()">
                    <input type="file" #backInput hidden (change)="onFileChange($event, 'idBack')" accept="image/*">
                    <span class="material-symbols-outlined file-upload-icon">{{ form.idBack ? 'check_circle' :
                        'contact_page'
                        }}</span>
                    <p class="file-upload-text text-primary font-semibold">{{ form.idBack ? 'تم رفع الوجه الخلفي' :
                        'صورة الوجه
                        الخلفي' }}</p>
                    <p class="file-upload-hint">PNG, JPG حتى 5MB</p>
                </div>
            </div>

            <div class="mt-6">
                <app-button type="submit" variant="primary" size="xl" [fullWidth]="true" [isLoading]="isLoading"
                    [disabled]="isLoading || !registerForm.valid">
                    إنشاء الحساب
                </app-button>
            </div>

            <div class="text-center mt-6">
                <app-button variant="ghost" (onClick)="currentStep = 1">
                    العودة للخلف
                </app-button>
            </div>
        </form>
    </div>

    <!-- Footer Links -->
    <footer class="mt-auto pt-xl flex gap-2xl text-secondary text-sm">
        <a href="#" class="text-secondary">المساعدة</a>
        <a href="#" class="text-secondary">الشروط والأحكام</a>
        <a href="#" class="text-secondary">سياسة الخصوصية</a>
    </footer>
    <p class="text-muted text-xs mt-4">© 2024 بطولة رمضان. جميع الحقوق محفوظة.</p>
</div>