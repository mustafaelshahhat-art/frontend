<div class="auth-container bg-gradient-login min-h-screen flex flex-center relative overflow-hidden p-2xl">
    <div class="ramadan-pattern absolute inset-0"></div>

    <div class="auth-card relative z-10 w-full animate-fade-in-up">
        <header class="text-center mb-2xl">
            <div class="auth-logo gradient-primary shadow-glow mb-6 mx-auto">
                <span class="material-symbols-outlined text-4xl text-primary">key</span>
            </div>
            <h1 class="auth-title mb-2">تعيين كلمة مرور جديدة</h1>
            <p class="text-secondary text-base">أدخل رمز التفعيل الذي وصلك وكلمة المرور الجديدة</p>
        </header>

        <div class="auth-card-body">
            <app-alert *ngIf="errorMessage()" type="danger" [dismissible]="true" [autoDismiss]="5000"
                (onClose)="errorMessage.set(null)" class="mb-lg">
                {{ errorMessage() }}
            </app-alert>
            <app-alert *ngIf="successMessage()" type="success" [dismissible]="true" [autoDismiss]="5000"
                (onClose)="successMessage.set(null)" class="mb-lg">
                {{ successMessage() }}
            </app-alert>

            <form [formGroup]="resetForm" (ngSubmit)="onSubmit()" class="auth-form flex flex-col gap-6">
                <app-form-control formControlName="otp" label="كود التفعيل" type="number" placeholder="123456"
                    iconLeft="tag" [error]="(otp?.invalid && otp?.touched) ? 'الكود مطلوب من 6 أرقام' : undefined">
                </app-form-control>

                <app-form-control formControlName="password" label="كلمة المرور الجديدة" type="password"
                    placeholder="********" iconLeft="lock"
                    [error]="(password?.invalid && password?.touched) ? 'يجب أن تكون 6 أحرف على الأقل' : undefined">
                </app-form-control>

                <app-form-control formControlName="confirmPassword" label="تأكيد كلمة المرور" type="password"
                    placeholder="********" iconLeft="lock_clock"
                    [error]="(resetForm.hasError('mismatch') && confirmPassword?.touched) ? 'كلمات المرور غير متطابقة' : undefined">
                </app-form-control>

                <div class="flex flex-col items-center gap-6 mt-4">
                    <app-button type="submit" variant="primary" size="xl" [isLoading]="isLoading()"
                        [disabled]="isLoading() || isResending()" class="min-w-[200px]">
                        تغيير كلمة المرور
                    </app-button>

                    <button type="button" (click)="resendOtp()"
                        class="text-sm font-semibold text-secondary hover:text-primary transition-colors flex items-center gap-2"
                        [disabled]="isLoading() || isResending() || !canResend()">
                        <span class="material-symbols-outlined text-lg">restart_alt</span>
                        <span>إعادة إرسال الكود</span>
                        <span *ngIf="!canResend()" class="text-xs opacity-70">( {{ resendCountdown() }} ثانية )</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>