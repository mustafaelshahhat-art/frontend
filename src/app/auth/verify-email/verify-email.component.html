<div class="auth-container min-h-screen flex flex-center p-xl">
    <!-- Background Texture -->
    <div class="ramadan-pattern absolute inset-0"></div>

    <div class="auth-card relative z-10 w-full" [class.animate-fade-in-up]="isPageReady()">
        <!-- Header Section -->
        <header class="text-center mb-xl">
            <div class="auth-logo mx-auto">
                <app-icon name="verified_user" class=" icon-sm"></app-icon>
            </div>
            <h1 class="auth-title mb-2">تفعيل الحساب</h1>
            <p class="text-secondary text-base">أدخل رمز التحقق المكوّن من 6 أرقام</p>
            <div class="mt-2 flex items-center justify-center gap-2">
                <span class="text-muted text-sm dir-ltr">{{ email }}</span>
                <app-icon name="alternate_email" class="text-sm text-neutral-500 icon-sm"></app-icon>
            </div>
        </header>

        <div class="auth-card-body">
            <!-- Global Alerts -->
            @if (errorMessage()) {
            <app-alert type="danger" [dismissible]="true" [autoDismiss]="5000" (dismissed)="errorMessage.set(null)"
                class="mb-lg">
                {{ errorMessage() }}
            </app-alert>
            }

            @if (successMessage()) {
            <app-alert type="success" [dismissible]="true" [autoDismiss]="5000" (dismissed)="successMessage.set(null)"
                class="mb-lg">
                {{ successMessage() }}
            </app-alert>
            }

            <!-- Verification Form -->
            <form [formGroup]="verifyForm" (ngSubmit)="onSubmit()" class="auth-form">

                <!-- OTP Inputs (Strict Horizontal Row) -->
                <div class="otp-input-container mb-xl" (paste)="onPaste($event)">
                    @for (key of otpDigits; track $index) {
                    <input [id]="'digit-' + $index" [formControlName]="key" type="text" inputmode="numeric"
                        pattern="[0-9]*" maxlength="1" placeholder="•" class="otp-field"
                        (input)="onInput($event, $index)" (keydown)="onKeyDown($event, $index)"
                        autocomplete="one-time-code">
                    }
                </div>

                <!-- Primary Action -->
                <div class="flex justify-center mb-xl">
                    <app-button type="submit" variant="primary" size="xl" [isLoading]="isLoading()"
                        [disabled]="verifyForm.invalid || isLoading() || isResending()" class="min-w-[220px]"
                        icon="verified" iconPos="left">
                        تفعيل الحساب
                    </app-button>
                </div>

                <div class="divider"></div>

                <!-- Navigation & Resend -->
                <div class="flex flex-col gap-5 items-center">
                    <button type="button" (click)="resendOtp()" class="resend-btn text-sm font-semibold"
                        [disabled]="isLoading() || isResending() || !canResend()">
                        <app-icon name="restart_alt" class="text-lg icon-sm"></app-icon>
                        <span>إعادة إرسال الرمز</span>
                        @if (!canResend()) {
                        <span class="text-xs opacity-70">( {{ resendCountdown() }} ثانية )</span>
                        }
                    </button>

                    <a routerLink="/auth/login"
                        class="text-muted text-sm hover:text-primary transition-colors flex items-center gap-1 group">
                        <app-icon name="arrow_forward" class="text-base group-hover:translate-x-1 transition-transform icon-sm"></app-icon>
                        <span>العودة لتسجيل الدخول</span>
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>