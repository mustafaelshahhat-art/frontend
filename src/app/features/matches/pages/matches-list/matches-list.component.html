<div class="matches-page">
    <app-page-header [title]="pageTitle" [subtitle]="pageSubtitle">
        <app-button *ngIf="isAdmin()" variant="ghost" size="sm" icon="calendar_month">
            عرض الجدول الكامل
        </app-button>
    </app-page-header>

    <div class="matches-container">
        <!-- Filters Area -->
        <app-filter [items]="filters" [activeValue]="selectedFilter()" (change)="setFilter($event)">
        </app-filter>

        <!-- Loading State -->
        <app-inline-loading *ngIf="isLoading()" message="جاري تحميل المباريات...">
        </app-inline-loading>

        <!-- Empty State -->
        <app-empty-state *ngIf="!isLoading() && filteredMatches().length === 0" icon="event_busy"
            title="لا توجد مباريات" [description]="emptyStateDescription">
        </app-empty-state>

        <!-- Matches Grid -->
        <div *ngIf="!isLoading() && filteredMatches().length > 0" class="matches-grid">
            <app-match-card *ngFor="let match of filteredMatches(); trackBy: trackById" [match]="match"
                (click)="viewMatch(match.id)" class="clickable-match-card">

                <div class="match-card-actions" actions>
                    <!-- Admin: Update Score -->
                    <app-button *ngIf="isAdmin()" (click)="$event.stopPropagation(); updateScore(match)" size="sm"
                        variant="outline" icon="scoreboard">
                        تحديث النتيجة
                    </app-button>

                    <!-- Referee: Start Match -->
                    <app-button *ngIf="isReferee() && match.status === MatchStatus.SCHEDULED"
                        (click)="$event.stopPropagation(); startMatch(match)" size="sm" variant="primary"
                        icon="play_arrow">
                        بدء المباراة
                    </app-button>

                    <!-- Referee: Live Actions -->
                    <div *ngIf="isReferee() && match.status === MatchStatus.LIVE" class="live-actions">
                        <app-button (click)="$event.stopPropagation(); openEventModal(match)" size="sm"
                            variant="primary" icon="edit_note" style="flex: 1;">
                            حدث
                        </app-button>
                        <app-button (click)="$event.stopPropagation(); onEndMatchClick(match)" size="sm"
                            variant="danger" icon="stop_circle" style="flex: 1;">
                            إنهاء
                        </app-button>
                    </div>

                    <!-- Details Link for others -->
                    <app-button *ngIf="!isAdmin() && (!isReferee() || match.status === MatchStatus.FINISHED)"
                        variant="ghost" size="sm" icon="chevron_left">
                        التفاصيل
                    </app-button>
                </div>
            </app-match-card>
        </div>
    </div>
</div>

<!-- Modals -->
<app-end-match-confirm [matchId]="activeMatchId || ''" [(visible)]="showEndMatchConfirm"
    (matchEnded)="onMatchEnded($event)">
</app-end-match-confirm>

<app-match-event-modal [match]="activeMatch" [(visible)]="showEventModal" (eventAdded)="onEventAdded($event)">
</app-match-event-modal>