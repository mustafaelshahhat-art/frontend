<!-- Filters Template -->
<ng-template #filtersTemplate>
    <app-filter [items]="filters" [activeValue]="currentFilter" (filterChange)="setFilter($event)" />
</ng-template>

<!-- Main Content -->
<div class="flex-col gap-md">
    <!-- Loading State -->
    <!-- Loading State -->
    @if (isLoading()) {
    <app-inline-loading message="جاري تحميل الطلبات..." />
    }

    <!-- Empty State -->
    @if (!isLoading() && filteredRequests.length === 0) {
    <app-empty-state icon="payments" title="لا توجد طلبات دفع" description="لا توجد طلبات دفع في هذا التصنيف حالياً" />
    }

    <!-- Table -->
    @if (!isLoading() && filteredRequests.length > 0) {
    <div class="card p-0 overflow-hidden">
        <app-table [data]="filteredRequests" [columns]="columns" [loading]="isLoading()" />
    </div>
    }
</div>

<!-- Team Template -->
<ng-template #teamInfo let-row="row">
    <div class="flex-col">
        <span class="text-primary font-bold text-sm">{{ row.registration.teamName }}</span>
        <span class="text-xs text-muted">{{ row.tournament?.name }}</span>
    </div>
</ng-template>

<!-- Amount Template -->
<ng-template #amountInfo let-row="row">
    <span class="text-gold font-bold">{{ row.tournament?.entryFee }} ج.م</span>
</ng-template>

<!-- Date Template -->
<ng-template #dateInfo let-row="row">
    <span class="text-muted text-xs">{{ row.registration.registeredAt | date:'yyyy-MM-dd' }}</span>
</ng-template>

<!-- Sender Number Template -->
<ng-template #senderNumberInfo let-row="row">
    <span class="text-info font-medium">{{ row.registration.senderNumber || '-' }}</span>
</ng-template>

<!-- Status Template -->
<ng-template #statusInfo let-row="row">
    <app-badge [type]="getBadgeType(row.registration.status)">
        {{ getStatusLabel(row.registration.status) }}
    </app-badge>
</ng-template>

<!-- Receipt Template -->
<ng-template #receiptInfo let-row="row">
    <app-button (click)="viewReceipt(row)" variant="ghost" size="sm" class="text-info">
        عرض الإيصال
    </app-button>
</ng-template>

<!-- Action Template -->
<ng-template #actionInfo let-row="row">
    @if (row.registration.status === RegistrationStatus.PENDING_PAYMENT_REVIEW && canManageRequest(row.tournament)) {
    <div class="action-buttons">
        <app-button (click)="approve(row)" variant="ghost" size="sm" icon="check_circle" class="text-primary" />
        <app-button (click)="reject(row)" variant="ghost" size="sm" icon="cancel" class="text-danger" />
    </div>
    } @else {
    <span class="text-muted text-xs">-</span>
    }
</ng-template>

<!-- Receipt Modal -->
@if (showReceiptModal) {
<div class="receipt-modal-overlay" (click)="closeReceipt()" (keyup.escape)="closeReceipt()" tabindex="0">
    <div class="receipt-modal-content animate-fade-in-up" (click)="$event.stopPropagation()"
        (keyup)="$event.stopPropagation()" tabindex="-1">
        <div class="modal-header">
            <h3>إيصال دفع: {{ selectedRequest?.registration?.teamName }}</h3>
            <button class="close-btn" (click)="closeReceipt()">
                <app-icon name="close" class=" icon-sm"></app-icon>
            </button>
        </div>
        <div class="modal-body">
            <img [src]="selectedRequest?.registration?.paymentReceiptUrl" alt="Receipt" class="receipt-image">
        </div>
        <div class="modal-footer">
            <app-button variant="outline" (click)="closeReceipt()">إغلاق</app-button>
        </div>
    </div>
</div>
}