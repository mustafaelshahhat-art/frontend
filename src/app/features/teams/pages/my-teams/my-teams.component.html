@if (!loading() && teamsOverview()) {

<!-- PENDING JOIN REQUESTS / INVITATIONS -->
@if (teamsOverview()!.pendingInvitations.length > 0) {
<div class="section">
    <h2 class="section-title">الدعوات المعلقة</h2>
    <app-join-requests-panel
        variant="invitations"
        [pendingInvitations]="teamsOverview()!.pendingInvitations"
        (acceptRequest)="acceptInvite($event)"
        (rejectRequest)="rejectInvite($event)" />
</div>
}

<!-- TEAMS I OWN -->
@if (teamsOverview()!.ownedTeams.length > 0) {
<div class="section">
    <h2 class="section-title">الفرق التي أملكها</h2>
    <div class="teams-grid">
        @for (team of teamsOverview()!.ownedTeams; track team.id) {
        <app-team-card
            [team]="team"
            variant="owned"
            (cardClick)="navigateToTeamDetail($event)" />
        }
    </div>
</div>
}

<!-- TEAMS I AM A MEMBER OF -->
@if (teamsOverview()!.memberTeams.length > 0) {
<div class="section">
    <h2 class="section-title">الفرق التي أنا منضم إليها</h2>
    <div class="teams-grid">
        @for (team of teamsOverview()!.memberTeams; track team.id) {
        <app-team-card
            [team]="team"
            variant="member"
            (cardClick)="navigateToTeamDetail($event)" />
        }
    </div>
</div>
}


}

@if (loading()) {
<div class="loading-container">
    <p>جاري التحميل...</p>
</div>
}

@if (!loading() && (!teamsOverview() || (teamsOverview()!.ownedTeams.length === 0 && teamsOverview()!.memberTeams.length
=== 0 && teamsOverview()!.pendingInvitations.length === 0))) {
<div class="no-team-container">
    <!-- Case 1: Account Pending -->
    @if (isUserPending()) {
    <div class="create-team-card pending-card animate-fade-in-up">
        <div class="icon-circle warning">
            <app-icon name="pending_actions" class=" icon-sm"></app-icon>
        </div>
        <h2>حسابك قيد المراجعة</h2>
        <p>عذراً، لا يمكنك إنشاء فريق حتى يتم اعتماد حسابك من قبل إدارة البطولة. يرجى الانتظار، سيتم إخطارك فور التفعيل.
        </p>

        <app-button variant="ghost" icon="refresh" (click)="loadTeamData()" class="w-full">
            تحديث الحالة
        </app-button>
    </div>
    }

    <!-- Case 2: Account Active, No Team, Has Invitation -->
    @if (!isUserPending() && pendingInvitations().length > 0) {
    <div class="create-team-card invite-card animate-fade-in-up">
        <div class="icon-circle primary">
            <app-icon name="mail" class=" icon-sm"></app-icon>
        </div>
        <h2>لديك دعوة للانضمام إلى فريق</h2>
        @for (invite of pendingInvitations(); track invite.id) {
        <div class="invite-item">
            <p>فريق <strong>{{ invite.teamName }}</strong> يدعوك للانضمام إليه.</p>
            <div class="flex gap-4">
                <app-button (click)="acceptInvite(invite.id)" variant="primary" icon="check"
                    class="flex-1">قبول</app-button>
                <app-button (click)="rejectInvite(invite.id)" variant="outline" icon="close"
                    class="flex-1">رفض</app-button>
            </div>
        </div>
        }
    </div>
    }

    <!-- Case 3: Account Active, No Team, No Invitation -->
    @if (!isUserPending() && pendingInvitations().length === 0) {
    <div class="create-team-card animate-fade-in-up">
        <div class="icon-circle">
            <app-icon name="groups" class=" icon-sm"></app-icon>
        </div>
        <h2>أنت لست عضواً في أي فريق</h2>
        <p>قم بإنشاء فريقك الخاص الآن وقد فريقك نحو البطولة!</p>
    </div>
    }
</div>
}

<!-- CREATE TEAM DIALOG -->
<app-create-team-dialog
    [visible]="showCreateTeamModal"
    [isCreating]="creatingTeam"
    (closeDialog)="closeCreateTeamModal()"
    (createTeam)="onCreateTeamFromDialog($event)" />