<div class="tournament-card-premium" [class.clickable]="isClickable"
    [class.is-finished]="tournament.status === TournamentStatus.COMPLETED" (click)="onCardClick()"
    (keydown)="onKeyDown($event)" [tabindex]="isClickable ? 0 : -1" [attr.role]="isClickable ? 'button' : 'article'">
    <!-- Banner with Icon and Status Badge -->
    <div class="tournament-banner" [class.winner-glow]="tournament.winnerTeamId">
        <app-smart-image [src]="tournament.imageUrl" type="tournament" size="custom" class="banner-image" />

        <!-- Winner Trophy Overlay -->
        @if (tournament.winnerTeamId) {
        <span class="material-symbols-outlined trophy-icon animate-bounce-subtle">emoji_events</span>
        }

        <!-- Status Badge -->
        <div class="status-badge-overlay">
            <app-badge [type]="badgeType">
                <span class="status-dot" [class]="'dot-' + (tournament.status | kebabCase)"></span>
                {{ tournament.status | statusLabel }}
            </app-badge>
        </div>

        <!-- Winner Banner Overlay -->
        @if (tournament.winnerTeamId && tournament.winnerTeamName) {
        <div class="winner-overlay">
            <div class="winner-content">
                <span class="crown">ğŸ‘‘</span>
                <span class="winner-label">Ø§Ù„Ø¨Ø·Ù„</span>
                <span class="winner-name">{{ tournament.winnerTeamName }}</span>
            </div>
        </div>
        }
    </div>

    <!-- Tournament Info -->
    <div class="tournament-info">
        <h3>{{ tournament.name }}</h3>
        <p>{{ tournament.description }}</p>

        <!-- Phase Description (Hover/Always visible) -->
        <div class="phase-indicator">
            <span class="material-symbols-outlined">{{ getPhaseIcon() }}</span>
            <span class="phase-text">{{ getPhaseDescription() }}</span>
        </div>
    </div>

    <!-- Stats Row -->
    <div class="tournament-stats">
        <div class="stat-item">
            <div class="stat-header">
                <span class="material-symbols-outlined">payments</span>
                <span class="label">Ø§Ù„Ø¬Ø§Ø¦Ø²Ø©</span>
            </div>
            <span class="value">{{ tournament.prizes || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯' }}</span>
        </div>
        <div class="stat-item">
            <div class="stat-header">
                <span class="material-symbols-outlined">calendar_today</span>
                <span class="label">{{ tournament.status === TournamentStatus.COMPLETED ? 'Ø§Ù†ØªÙ‡Øª ÙÙŠ' : 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡'
                    }}</span>
            </div>
            <span class="value">{{ (tournament.status === TournamentStatus.COMPLETED ? tournament.endDate :
                tournament.startDate) | date:'yyyy/MM/dd' }}</span>
        </div>
    </div>

    <!-- Registration Progress Bar -->
    <div class="fill-bar-wrapper">
        <div class="fill-label">
            <span>Ø§Ù„ÙØ±Ù‚ Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</span>
            <span>{{ tournament.currentTeams }} / {{ tournament.maxTeams }}</span>
        </div>
        <div class="fill-bar">
            <div class="fill-progress" [class.full]="progressPercent >= 100"></div>
        </div>
    </div>

    <!-- Contextual Info Messages -->
    <div class="context-messages-container">
        @if (showRegisterButton) {
        <div class="context-messages">
            <!-- Captain: Already Registered Status -->
            @if (isRegistered && myRegistration?.status === RegistrationStatus.PENDING_PAYMENT_REVIEW) {
            <div class="context-msg pending">
                <span class="material-symbols-outlined">hourglass_top</span>
                <span>Ø·Ù„Ø¨Ùƒ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© - Ø£Ù†Øª Ù…Ø³Ø¬Ù„ Ù…Ø¤Ù‚ØªØ§Ù‹</span>
            </div>
            }
            @if (isRegistered && myRegistration?.status === RegistrationStatus.APPROVED) {
            <div class="context-msg approved">
                <span class="material-symbols-outlined">verified</span>
                <span>ÙØ±ÙŠÙ‚Ùƒ Ù…ÙÙˆØ§ÙÙÙ‚ Ø¹Ù„ÙŠÙ‡ Ø±Ø³Ù…ÙŠØ§Ù‹</span>
            </div>
            }
            @if (myRegistration?.status === RegistrationStatus.REJECTED) {
            <div class="context-msg rejected">
                <span class="material-symbols-outlined">error</span>
                <span>ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨ - ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù…Ø¬Ø¯Ø¯Ø§Ù‹</span>
            </div>
            }

            <!-- Captain: Team Busy -->
            @if (isBusy && !isRegistered) {
            <div class="context-msg busy">
                <span class="material-symbols-outlined">block</span>
                <span>ÙØ±ÙŠÙ‚Ùƒ Ù…Ø´Ø§Ø±Ùƒ ÙÙŠ Ø¨Ø·ÙˆÙ„Ø© Ø£Ø®Ø±Ù‰</span>
            </div>
            }

            <!-- User Pending Approval -->
            @if (isUserPending) {
            <div class="context-msg warning">
                <span class="material-symbols-outlined">pending</span>
                <span>Ø­Ø³Ø§Ø¨Ùƒ Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªÙØ¹ÙŠÙ„</span>
            </div>
            }
        </div>
        }

        <!-- Team Disabled Info -->
        @if (isTeamDisabled) {
        <div class="context-messages">
            <div class="context-msg rejected animate-pulse-subtle">
                <span class="material-symbols-outlined">warning</span>
                <span>ØªÙ… ØªØ¹Ø·ÙŠÙ„ Ø§Ù„ÙØ±ÙŠÙ‚ Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</span>
            </div>
        </div>
        }

        <!-- Non-Owner Player Info -->
        @if (showNonOwnerHint && !isTeamDisabled) {
        <div class="context-messages">
            <div class="context-msg info">
                <span class="material-symbols-outlined">info</span>
                <span>Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù…ØªØ§Ø­ Ù„Ù‚Ø§Ø¦Ø¯ Ø§Ù„ÙØ±ÙŠÙ‚ ÙÙ‚Ø·</span>
            </div>
        </div>
        }

        <!-- Finished Tournament Message -->
        @if (tournament.status === TournamentStatus.COMPLETED) {
        <div class="context-messages">
            <div class="context-msg finished">
                <span class="material-symbols-outlined">flag</span>
                <span>Ø§Ù†ØªÙ‡Øª Ù‡Ø°Ù‡ Ø§Ù„Ø¨Ø·ÙˆÙ„Ø©</span>
            </div>
        </div>
        }
    </div>

    <!-- Action Buttons -->
    <div class="tournament-actions">
        <app-button variant="primary" class="flex-1" (click)="onViewDetailsClick($event)">
            {{ tournament.status === TournamentStatus.COMPLETED ? 'Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬' : 'Ø§Ù„ØªÙØ§ØµÙŠÙ„' }}
        </app-button>

        <!-- Captain Registration Button -->
        @if (showRegisterButton && tournament.status === TournamentStatus.REGISTRATION_OPEN) {
        <app-button [variant]="getRegisterButtonVariant()" class="flex-1" (click)="onRegisterClick($event)"
            [disabled]="isRegisterDisabled" [title]="getRegisterTooltip()">
            @if (getRegisterIcon()) {
            <span class="material-symbols-outlined btn-icon">{{ getRegisterIcon() }}</span>
            }
            {{ getRegisterLabel() }}
        </app-button>
        }
    </div>
</div>