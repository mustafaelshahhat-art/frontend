<div class="tournament-detail-page">
    <div class="tournament-detail-container">
        <!-- Loading -->
        @if (isLoading()) {
        <div class="loading-state">
            <div class="spinner"></div>
            <p>جاري تحميل البيانات...</p>
        </div>
        }

        @if (!isLoading() && tournament(); as t) {
        <!-- Banner Card -->
        <app-card class="tournament-banner-card">
            <div class="banner-overlay"></div>
            <app-tournament-header>
                <div header-actions class="banner-actions">
                    <!-- Admin Actions -->
                    <app-tournament-actions [isGeneratingMatches]="isGeneratingMatches()"
                        (editTournament)="editTournament()" (deleteTournament)="deleteTournament()"
                        (toggleStatus)="toggleStatus()" (generateMatches)="generateMatches()"
                        (startTournament)="startTournament()" (confirmQualification)="confirmQualification()"
                        (startManualDraw)="startManualDraw()" (selectOpeningMatch)="selectOpeningMatch()"
                        (resetSchedule)="resetSchedule()" (emergencyStart)="emergencyStart()"
                        (emergencyEnd)="emergencyEnd()" />

                    <!-- Captain Registration Actions -->
                    <app-tournament-registrations (registerTeam)="registerTeam()" (withdrawTeam)="withdrawTeam()" />
                </div>
            </app-tournament-header>
        </app-card>

        <!-- ─── Sticky Navigation Filter ─── -->
        <app-filter [items]="tabs()" [activeValue]="activeTab()" (filterChange)="onTabChange($event)"
            class="tab-filter" />

        <!-- ─── Tab Content (conditional render based on mode) ─── -->
        <div class="tab-content">
            @switch (activeTab()) {
            @case ('info') {
            <app-info-tab />
            }
            @case ('standings') {
            @if (showStandings()) {
            <app-standings-tab />
            }
            }
            @case ('bracket') {
            @if (showBracket()) {
            <app-bracket-tab />
            }
            }
            @case ('matches') {
            <app-matches-tab />
            }
            @case ('teams') {
            <app-teams-tab />
            }
            }
        </div>
        }
    </div>
</div>

<!-- Registration Modal -->
<app-team-registration-modal [tournament]="tournament()!" [isVisible]="isRegisterModalVisible()"
    (closeEvent)="closeRegisterModal()" (successEvent)="onRegistrationSuccess($event)" />

<!-- Opening Match Modal -->
@if (canSelectOpeningMatch() && tournament()) {
<app-opening-match-modal [tournament]="tournament()!" [isVisible]="isOpeningMatchModalVisible()"
    (close)="closeOpeningMatchModal()" (submit)="onOpeningMatchSelected($event)" />
}