<div class="manage-tournament-page">

    <div class="form-container">
        <form [formGroup]="tournamentForm" (ngSubmit)="onSubmit()">
            <div class="form-grid">
                <!-- Basic Info -->
                <app-card title="المعلومات الأساسية" class="form-section">
                    <div class="fields-grid">
                        <app-form-control label="اسم البطولة" iconLeft="emoji_events" formControlName="name"
                            [control]="tournamentForm.get('name')" placeholder="مثلاً: بطولة رمضان الكبرى" />

                        <app-form-control label="الموقع" iconLeft="location_on" formControlName="location"
                            [control]="tournamentForm.get('location')" placeholder="مثلاً: الرياض، ملعب الربوة" />

                        <app-form-control label="وصف البطولة" iconLeft="description" type="textarea" class="full-width"
                            formControlName="description" [control]="tournamentForm.get('description')" [rows]="3"
                            placeholder="اكتب وصفاً مختصراً للبطولة..." />
                    </div>
                </app-card>

                <!-- Dates & Capacity -->
                <app-card title="التواريخ والسعة" class="form-section">
                    <div class="fields-grid">
                        <app-form-control label="تاريخ البدء" iconLeft="calendar_today" type="date"
                            formControlName="startDate" [control]="tournamentForm.get('startDate')" />

                        <app-form-control label="تاريخ الانتهاء" iconLeft="event_busy" type="date"
                            formControlName="endDate" [control]="tournamentForm.get('endDate')" />

                        <app-form-control label="أخر موعد للتسجيل" iconLeft="timer" type="date"
                            formControlName="registrationDeadline"
                            [control]="tournamentForm.get('registrationDeadline')" />

                        <app-form-control label="عدد الفرق الأقصى" iconLeft="groups" type="number"
                            formControlName="maxTeams" [control]="tournamentForm.get('maxTeams')" />
                    </div>
                </app-card>

                <!-- Tournament System -->
                <app-card title="نظام البطولة" class="form-section">
                    <div class="fields-grid">
                        <app-select label="نظام البطولة" icon="settings" [options]="modes" formControlName="mode"
                            [required]="true" />

                        <app-select label="نظام القرعة والتصنيف" icon="shuffle" [options]="seedingModes"
                            formControlName="seedingMode" [required]="true" />

                        <app-select label="طريقة جدولة المباريات" icon="edit_calendar" [options]="schedulingModes"
                            formControlName="schedulingMode" [required]="true" />


                        @if (tournamentForm.get('mode')?.value === 3 ||
                        tournamentForm.get('mode')?.value === 4) {
                        <app-form-control label="عدد المجموعات" iconLeft="grid_view" type="number"
                            formControlName="numberOfGroups" [control]="tournamentForm.get('numberOfGroups')" />

                        <app-form-control label="المتأهلين من كل مجموعة" iconLeft="filter_1" type="number"
                            formControlName="qualifiedTeamsPerGroup"
                            [control]="tournamentForm.get('qualifiedTeamsPerGroup')" placeholder="1, 2, أو 3" />
                        }
                    </div>
                </app-card>

                <!-- Registration Policy -->
                <app-card title="سياسة التسجيل" class="form-section">
                    <div class="fields-grid">
                        <div class="checkbox-container full-width"
                            style="margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox" id="allowLateRegistration" formControlName="allowLateRegistration">
                            <label for="allowLateRegistration">السماح بالتسجيل المتأخر (بعد اكتمال العدد أو انتهاء
                                الموعد)</label>
                        </div>

                        @if (tournamentForm.get('allowLateRegistration')?.value) {
                        <app-select label="نوع التسجيل المتأخر" icon="history_edu" [options]="lateRegistrationModes"
                            formControlName="lateRegistrationMode" [required]="true" />
                        }
                    </div>
                </app-card>

                <!-- Financials & Rules -->
                <app-card title="الرسوم والقوانين" class="form-section">
                    <div class="fields-grid">
                        <app-form-control label="رسوم الاشتراك (ريال)" iconLeft="payments" type="number"
                            formControlName="entryFee" [control]="tournamentForm.get('entryFee')" />

                        <!-- Wallet -->
                        <div class="payment-group" style="display: contents;">
                            <app-form-control label="اسم وسيلة الدفع 1 (محفظة)" iconLeft="label"
                                formControlName="walletLabel" [control]="tournamentForm.get('walletLabel')"
                                placeholder="فودافون كاش" />

                            <app-form-control label="رقم المحفظة" iconLeft="account_balance_wallet"
                                formControlName="walletNumber" [control]="tournamentForm.get('walletNumber')"
                                placeholder="01xxxxxxxxx" />
                        </div>

                        <!-- InstaPay -->
                        <div class="payment-group" style="display: contents;">
                            <app-form-control label="اسم وسيلة الدفع 2 (InstaPay)" iconLeft="label"
                                formControlName="instaPayLabel" [control]="tournamentForm.get('instaPayLabel')"
                                placeholder="InstaPay" />

                            <app-form-control label="عنوان الدفع (VPA)" iconLeft="currency_exchange"
                                formControlName="instaPayNumber" [control]="tournamentForm.get('instaPayNumber')"
                                placeholder="user@instapay" />
                        </div>

                        <app-form-control label="قوانين البطولة" iconLeft="gavel" type="textarea" class="full-width"
                            formControlName="rules" [control]="tournamentForm.get('rules')" [rows]="4"
                            placeholder="اكتب شروط وقوانين البطولة هنا..." />

                        <app-form-control label="جوائز البطولة" iconLeft="workspace_premium" type="textarea"
                            class="full-width" formControlName="prizes" [control]="tournamentForm.get('prizes')"
                            [rows]="3" placeholder="مثلاً: المركز الأول: 5000 ريال، المركز الثاني: 3000 ريال..." />
                    </div>
                </app-card>

                <!-- Action Buttons -->
                <div class="form-actions">
                    <app-button variant="outline" type="button" (trigger)="cancel()">إلغاء</app-button>
                    <app-button variant="primary" type="submit" [disabled]="tournamentForm.invalid || isSubmitting()">
                        {{ isSubmitting() ? 'جاري الحفظ...' : (isEditMode() ? 'حفظ التغييرات' : 'إنشاء البطولة') }}
                    </app-button>
                </div>
            </div>
        </form>
    </div>
</div>