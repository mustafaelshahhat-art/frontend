<div class="manage-tournament-page">

    <div class="form-container">
        <form [formGroup]="tournamentForm" (ngSubmit)="onSubmit()">
            <div class="form-grid">
                <!-- Basic Info -->
                <app-card title="المعلومات الأساسية" class="form-section">
                    <div class="fields-grid">
                        <app-form-control label="اسم البطولة" iconLeft="emoji_events" formControlName="name"
                            [control]="tournamentForm.get('name')" placeholder="مثلاً: بطولة رمضان الكبرى" />

                        <app-form-control label="الموقع" iconLeft="location_on" formControlName="location"
                            [control]="tournamentForm.get('location')" placeholder="مثلاً: الرياض، ملعب الربوة" />

                        <app-form-control label="وصف البطولة" iconLeft="description" type="textarea" class="full-width"
                            formControlName="description" [control]="tournamentForm.get('description')" [rows]="3"
                            placeholder="اكتب وصفاً مختصراً للبطولة..." />
                    </div>
                </app-card>

                <!-- Dates & Capacity -->
                <app-card title="التواريخ والسعة" class="form-section">
                    <div class="fields-grid">
                        <app-form-control label="تاريخ البدء" iconLeft="calendar_today" type="date"
                            formControlName="startDate" [control]="tournamentForm.get('startDate')" />

                        <app-form-control label="تاريخ الانتهاء" iconLeft="event_busy" type="date"
                            formControlName="endDate" [control]="tournamentForm.get('endDate')" />

                        <app-form-control label="أخر موعد للتسجيل" iconLeft="timer" type="date"
                            formControlName="registrationDeadline"
                            [control]="tournamentForm.get('registrationDeadline')" />

                        <app-form-control label="عدد الفرق الأقصى" iconLeft="groups" type="number"
                            formControlName="maxTeams" [control]="tournamentForm.get('maxTeams')" />
                    </div>
                </app-card>

                <!-- Tournament System -->
                <app-card title="نظام البطولة" class="form-section">
                    <div class="fields-grid">
                        <app-select label="نظام البطولة" icon="settings" [options]="modes" formControlName="mode"
                            [required]="true" [control]="tournamentForm.get('mode')" />


                        @if (tournamentForm.get('mode')?.value > 2) {
                        <app-select label="نظام توزيع الفرق والجدولة" icon="calendar_month" [options]="schedulingModes"
                            formControlName="schedulingMode" [required]="true"
                            [control]="tournamentForm.get('schedulingMode')" />
                        }


                        @if (tournamentForm.get('mode')?.value === 3 ||
                        tournamentForm.get('mode')?.value === 4) {
                        <app-form-control label="عدد المجموعات" iconLeft="grid_view" type="number"
                            formControlName="numberOfGroups" [control]="tournamentForm.get('numberOfGroups')" />

                        }
                    </div>
                </app-card>



                <!-- Financials & Rules -->
                <app-card title="الرسوم والقوانين" class="form-section">
                    <div class="fields-grid">
                        <app-form-control label="رسوم الاشتراك (ج.م)" iconLeft="payments" type="number"
                            formControlName="entryFee" [control]="tournamentForm.get('entryFee')" class="full-width" />

                        <!-- Wallet -->
                        <div class="payment-group" style="display: contents;">
                            <app-form-control label="اسم وسيلة الدفع 1" iconLeft="label" formControlName="walletLabel"
                                [control]="tournamentForm.get('walletLabel')" placeholder="فودافون كاش" />

                            <app-form-control label="رقم المحفظة" iconLeft="account_balance_wallet"
                                formControlName="walletNumber" [control]="tournamentForm.get('walletNumber')"
                                placeholder="01xxxxxxxxx" />
                        </div>

                        <!-- InstaPay -->
                        <div class="payment-group" style="display: contents;">
                            <app-form-control label="اسم وسيلة الدفع 2" iconLeft="label" formControlName="instaPayLabel"
                                [control]="tournamentForm.get('instaPayLabel')" placeholder="InstaPay" />

                            <app-form-control label="عنوان الدفع (VPA)" iconLeft="currency_exchange"
                                formControlName="instaPayNumber" [control]="tournamentForm.get('instaPayNumber')"
                                placeholder="user@instapay" />
                        </div>

                        <app-form-control label="قوانين البطولة" iconLeft="gavel" type="textarea" class="full-width"
                            formControlName="rules" [control]="tournamentForm.get('rules')" [rows]="4"
                            placeholder="اكتب شروط وقوانين البطولة هنا..." />

                        <app-form-control label="جوائز البطولة" iconLeft="workspace_premium" type="textarea"
                            class="full-width" formControlName="prizes" [control]="tournamentForm.get('prizes')"
                            [rows]="3" placeholder="مثلاً: المركز الأول: 5000 ج.م، المركز الثاني: 3000 ج.م..." />
                    </div>
                </app-card>

                <!-- Action Buttons -->
                <div class="form-actions">
                    <div class="submit-feedback" *ngIf="tournamentForm.invalid && tournamentForm.touched">
                        <app-icon name="error_outline" class="icon-sm text-danger"></app-icon>
                        <span class="text-danger">يرجى إكمال جميع الحقول المطلوبة بشكل صحيح لتتمكن من إنشاء
                            البطولة.</span>
                    </div>

                    <div class="actions-group">
                        <app-button variant="outline" type="button" (trigger)="cancel()">إلغاء</app-button>
                        <app-button variant="primary" type="submit" [disabled]="isSubmitting()">
                            {{ isSubmitting() ? 'جاري الحفظ...' : (isEditMode() ? 'حفظ التغييرات' : 'إنشاء البطولة') }}
                        </app-button>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>