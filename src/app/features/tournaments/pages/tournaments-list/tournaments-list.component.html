<!-- Actions Template -->
<ng-template #actions>
    <app-button *appHasPermission="AppPermission.MANAGE_TOURNAMENTS" (click)="createNewTournament()" icon="add_circle">
        بطولة جديدة
    </app-button>
</ng-template>

<!-- Filters Template -->
<ng-template #filtersRef>
    <app-filter [items]="filters" [activeValue]="currentFilter()" (filterChange)="setFilter($event)" />
</ng-template>

<!-- Main Content -->
<!-- Loading State -->
@if (isLoading()) {
<app-inline-loading message="جاري تحميل البطولات..." />
}

<!-- Empty States Based on Context -->
@if (!isLoading() && pager.isEmpty()) {
<!-- No tournaments at all -->
@if (tournaments().length === 0) {
<app-empty-state icon="emoji_events" title="لا توجد بطولات حالياً"
    description="ترقبوا الإعلانات القادمة! سيتم الإعلان عن بطولات جديدة قريباً." />
}

<!-- Filter returned no results -->
@if (tournaments().length > 0) {
<app-empty-state icon="filter_alt_off" title="لا توجد نتائج" [description]="getEmptyFilterMessage()" />
}
}

<!-- Tournaments Grid -->
@if (!isLoading() && !pager.isEmpty()) {
<div class="tournaments-grid">
    @for (tournament of pager.items(); track tournament.id) {
    <app-tournament-card [tournament]="tournament" [showRegisterButton]="isCaptain()"
        [showNonOwnerHint]="!isCaptain() && hasTeam()" [isTeamDisabled]="isTeamDisabled()"
        (viewDetails)="viewDetails($event)" (register)="registerTeam($event)" />
    }
</div>

<!-- Load More -->
<app-load-more
    [hasNextPage]="pager.hasNextPage"
    [isLoading]="pager.isLoading"
    [summary]="pager.summary"
    (loadMore)="pager.loadMore()" />
}

<!-- Player Non-Owner Info Banner -->
@if (isPlayerWithoutTeam() && !isLoading() && !pager.isEmpty()) {
<div class="player-info-banner">
    <app-icon name="info" class=" icon-sm"></app-icon>
    <p>أنت مسجل كلاعب. يجب إنشاء فريق أولاً لتتمكن من التسجيل في البطولات.</p>
</div>
}

<!-- Full Registration Modal (Shared) -->
<app-team-registration-modal [tournament]="selectedTournamentForRegistration" [isVisible]="isRegistrationModalVisible"
    (closeEvent)="closeRegistrationModal()" (successEvent)="onRegistrationSuccess()" />