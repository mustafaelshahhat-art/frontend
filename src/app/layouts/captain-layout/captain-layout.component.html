<!-- Mobile Overlay -->
@if (isSidebarOpen && isMobile) {
<div (click)="closeSidebar()" (keydown.enter)="closeSidebar()" (keydown.space)="$event.preventDefault(); closeSidebar()"
  class="overlay" tabindex="0" role="button" aria-label="إغلاق القائمة"></div>
}

<div class="app-layout bg-gradient-page">

  <!-- Sidebar -->
  <app-sidebar [isOpen]="isSidebarOpen" [isMobile]="isMobile" [navItems]="filteredNavItems"
    [currentUser]="currentUser()" brandSubtitle="لوحة القائد" userRoleLabel="قائد الفريق"
    (closeSidebar)="closeSidebar()" (logout)="handleLogout()" />

  <!-- Main Content Area -->
  <div class="app-main" [class.mr-sidebar]="!isMobile">

    <!-- Header -->
    <app-header [isMobile]="isMobile" [windowSize]="windowSize" title="لوحة القائد" [unreadCount]="unreadCount()"
      [notifications]="notifications()" (toggleSidebar)="toggleSidebar()" (viewNotification)="viewNotification($event)"
      (viewAllNotifications)="viewAllNotifications()">

      <div breadcrumbs class="flex items-center gap-2">
        <span class="text-muted text-lg">/</span>
        <app-breadcrumb />
      </div>
    </app-header>

    <!-- Page Content (Scrollable) -->
    <main class="app-content">
      <div class="captain-page-container">
        <!-- Header Section -->
        @if (layout.title()) {
        <app-page-header [title]="layout.title()" [subtitle]="layout.subtitle()" [showBack]="layout.showBack()"
          (back)="layout.onBack()">
          <!-- Actions Slot -->
          @if (layout.actionHandler(); as handler) {
            <app-button (click)="handler()" variant="primary" size="md" icon="add">
                إنشاء فريق جديد
            </app-button>
          } @else {
            <ng-container *ngTemplateOutlet="layout.actionsTemplate() || null" />
          }
        </app-page-header>
        }

        <div class="captain-page-content">
          <!-- Filters Section -->
          @if (layout.filtersTemplate()) {
          <div class="captain-toolbar">
            <ng-container *ngTemplateOutlet="layout.filtersTemplate() || null" />
          </div>
          }

          <!-- Content Section -->
          <router-outlet />
        </div>
      </div>
    </main>

  </div>

</div>